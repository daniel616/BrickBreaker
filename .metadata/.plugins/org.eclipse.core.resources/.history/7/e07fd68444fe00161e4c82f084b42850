package application;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.List;
import java.util.Map;
import java.util.Set;

import TurtleDetails.Turtle;
import TurtleDetails.TurtleState;
import TurtleDetails.TurtleTrail;
import exceptions.StateNotFoundException;
import javafx.beans.binding.Bindings;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.collections.ObservableMap;
import javafx.collections.ObservableSet;
import javafx.scene.paint.Color;
/**
 * Contains all the info that is specific to each running SLogo application.
 * All data structures are observable.
 * Only returns
 * 
 * Needs to throw exceptions for unfound names.
 * 
 * @author Daniel
 *
 */
public class Model {
	private ObservableMap<String, Turtle> myTurtles;
	private ObservableSet<TurtleTrail> allTrails;
	private ObservableList<String> inputHistory;
	private ObservableMap<String,List<String>> userCommands;
	private ObservableMap<String,List<String>> userVariables;
	
	public Model(){
		myTurtles=FXCollections.observableMap(new HashMap<String,Turtle>());
		myTurtles.put("turtle", new Turtle());
		allTrails=FXCollections.observableSet(new HashSet<>());
		inputHistory=FXCollections.observableList(new ArrayList<>());
		userCommands=FXCollections.observableMap(new HashMap<>());
		userVariables=FXCollections.observableMap(new HashMap<>());
	}
	
	public void addTurtle(String turtleName, Turtle turtle){
		myTurtles.put(turtleName, turtle);
	}
	
	public Turtle getTurtle(){
		return myTurtles.get("turtle");
	}
	
	private Turtle getTurtle(String turtleName){
		return myTurtles.get(turtleName);
	}
	
	public void removeTurtle(String turtleName){
		myTurtles.remove(turtleName);
	}
	
	public void updateTurtles() throws StateNotFoundException{
		for(Turtle turtle:myTurtles.values()){
			if(turtle.numStates()>1){
				turtle.removeFirstState();
			}
		}
	}

	public void addCommand(String command, String actions){
		userCommands.put(command, actions);
	}
	
	public void removeCommand(String command){
		userCommands.remove(command);
	}
	
	public void removeAllCommands(){
		userCommands.clear();
	}
	
	public void addVariable(String variable, String values){
		userVariables.put(variable, values);
	}
	
	public void updateTrails() throws StateNotFoundException{
		for(Turtle turtle:myTurtles.values()){
			if(turtle.numStates()>1){
				allTrails.add(turtle.nextTrail());
			}
		}
	}

	public void clearTrails(){
		allTrails.clear();
	}
	
	public Set<TurtleState> getTurtleStates() throws StateNotFoundException{
		Set<TurtleState> states=new HashSet<>();
		for(Turtle t:myTurtles.values()){
			states.add(t.getFirstTurtleState());
		}
		return states;
	}
	
	public List<String> readOnlyHistory(){
		return Collections.unmodifiableList(inputHistory);
	}
	
	public Map<String,String> readOnlyCommands(){
		return Collections.unmodifiableMap(userCommands);
	}
	
	public Map<String,String> readOnlyVariables(){
		return Collections.unmodifiableMap(userVariables);
	}
	
	public Set<TurtleTrail> readOnlyTrails(){
		return Collections.unmodifiableSet(allTrails);
	}
}