package BackEndGrid;


import java.util.ArrayList;
import java.util.Collections;
import java.util.List;

import Cells.Cell;
import Utils.UnknownLatticeException;
/**
 * This entire class is part of my Masterpiece.
 * DANIEL
 * @author Daniel
 * Base class that is used to store cell elements. Stores cells in a 2D array. 
 * Subclasses implement different getNeighbors functions.
 * 
 */
public class BackEndGrid {
	private Cell[][] myCellGrid;
	private int maxColumns;
	private int maxRows;
	private String latticeType;
	private final String SQUARE="square";
	private final String HEXAGON="hexagon";
	private final String TRIANGLE="triangle";
	private final int GROWTH_RANGE=5;
	private boolean infinite=false;
	private boolean toiroidal=false;

	public BackEndGrid(int size) {
		myCellGrid = new Cell[size][size];
		//myFileReader = new FileReader();//commented this because it caused compile errors, but may be put back in later
		this.maxColumns=size;
		this.maxRows=size;
	}
	//returns null and no exceptions
	/**
	 * 
	 * @param x
	 * @param y
	 * @return
	 * A helper method used for the getNeighbors list, that checks if a cell is reachable.
	 * If not, a null element is added to list, which is removed at the end of the getNeighbors function.
	 */
	public Cell tryGetCell(int x,int y){
		if(toiroidal) return myCellGrid[x%maxRows][y%maxColumns];
		if(x>=0&&x<maxRows&&y>=0&&y<maxColumns) return myCellGrid[x][y];
		return null;
	}
	//exceptions can occur
	/**
	 * 
	 * @param x
	 * @param y
	 * @return
	 * The method that can cause exceptions with incorrect, and should be used by other classes.
	 */
	public Cell getCell(int x,int y){
		if(toiroidal) return myCellGrid[x%maxRows][y%maxColumns];
		else return myCellGrid[x][y];
	}
	
	public int getRows(){
		return maxRows;
	}
	
	public int getColumns(){
		return maxColumns;
	}

	
	public void switchCell(Cell cell1, Cell cell2){
		int cell2Row=cell2.getRow();
		int cell2Col=cell2.getCol();
		
		setCell(cell1.getRow(), cell1.getCol(), cell2);
		setCell(cell2Row, cell2Col, cell1);
	}

	/**
	 * 
	 * @param row
	 * @param col
	 * @param cell
	 * Sets a cell at given location.
	 */
	public void setCell(int row, int col, Cell cell) {
		myCellGrid[row][col] = cell;
		cell.setCol(col);
		cell.setRow(row);
	}
	
	public List<Cell> getNeighbors(int row, int column){
		try{
			switch (latticeType){
				case (SQUARE):
					return getFourNeighbors(row,column);
				case(HEXAGON):
					return getHexagonNeighbors(row,column);
				case(TRIANGLE):
					return getTriangleNeighbors(row,column);
				default: {
					throw new UnknownLatticeException(latticeType);
				}
			}
		}
		catch (UnknownLatticeException e){
			return null;
		}
	}
	
	public List<Cell> getTriangleNeighbors(int row, int column) {
		// TODO Auto-generated method stub
		List<Cell> neighbors =new ArrayList<Cell>();
		neighbors.add(tryGetCell(row,column-1));
		neighbors.add(tryGetCell(row,column+1));
		if((row+column)%2==0){
			neighbors.add(tryGetCell(row-1,column));
		}else{
			neighbors.add(tryGetCell(row+1,column));
		}
		neighbors.removeAll(Collections.singleton(null));
		return neighbors;
	}
	
	public List<Cell> getFourNeighbors(int row, int col) {
		List<Cell> neighborList = new ArrayList<Cell>();
		if (row>0) {
			neighborList.add(tryGetCell(row-1,col));
		} if (row<getRows()-1) {
			neighborList.add(tryGetCell(row+1,col));
		} if (col>0) {
			neighborList.add(tryGetCell(row,col-1));
		} if (col<getColumns()-1) {
			neighborList.add(tryGetCell(row,col+1));
		}
		neighborList.removeAll(Collections.singleton(null));
		return neighborList;
		
	}
	
	private List<Cell> getHexagonNeighbors(int row, int column) {
		// TODO Auto-generated method stub
		List<Cell> neighbors=new ArrayList<Cell>();
		neighbors.add(tryGetCell(row-2,column));
		neighbors.add(tryGetCell(row+2,column));
		if(row%2==0){
			neighbors.add(tryGetCell(row-1,column-1));
			neighbors.add(tryGetCell(row+1,column-1));	
			neighbors.add(tryGetCell(row-1,column));
			neighbors.add(tryGetCell(row+1,column));
		}
		if(row%2==1){
			neighbors.add(tryGetCell(row-1,column));
			neighbors.add(tryGetCell(row+1,column));
			neighbors.add(tryGetCell(row-1,column+1));
			neighbors.add(tryGetCell(row+1,column+1));
		}
		neighbors.removeAll(Collections.singleton(null));
		return neighbors;
	}
	
	public void setLatticeType(String s){
		try{
			if(!(s.equals(SQUARE)||s.equals(HEXAGON)||s.equals(TRIANGLE))){
				throw new UnknownLatticeException(s);
			}
		}
		catch(UnknownLatticeException e){

		}
			latticeType=s;
			
	}
}
